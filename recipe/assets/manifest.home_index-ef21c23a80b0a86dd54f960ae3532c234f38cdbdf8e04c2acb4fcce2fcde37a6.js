Davis=function(t){var e=new Davis.App;return t&&t.call(e),Davis.$(function(){e.start()}),e},window.jQuery?Davis.$=jQuery:Davis.$=null,Davis.supported=function(){return"function"==typeof window.history.pushState},Davis.noop=function(){},Davis.extend=function(t){t(Davis)},Davis.version="0.9.9",Davis.utils=function(){if(Array.prototype.every)var t=function(t,e){return t.every(e,arguments[2])};else var t=function(t,e){if(void 0===t||null===t)throw new TypeError;var r=Object(t),n=r.length>>>0;if("function"!=typeof e)throw new TypeError;for(var o=arguments[2],i=0;n>i;i++)if(i in r&&!e.call(o,r[i],i,r))return!1;return!0};if(Array.prototype.forEach)var e=function(t,e){return t.forEach(e,arguments[2])};else var e=function(t,e){if(void 0===t||null===t)throw new TypeError;var r=Object(t),n=r.length>>>0;if("function"!=typeof e)throw new TypeError;for(var o=arguments[2],i=0;n>i;i++)i in r&&e.call(o,r[i],i,r)};if(Array.prototype.filter)var r=function(t,e){return t.filter(e,arguments[2])};else var r=function(t,e){if(void 0===t||null===t)throw new TypeError;var r=Object(t),n=r.length>>>0;if("function"!=typeof e)throw new TypeError;for(var o=[],i=arguments[2],a=0;n>a;a++)if(a in r){var s=r[a];e.call(i,s,a,r)&&o.push(s)}return o};if(Array.prototype.map)var n=function(t,e){return t.map(e,arguments[2])};else var n=function(t,e){if(void 0===t||null===t)throw new TypeError;var r=Object(t),n=r.length>>>0;if("function"!=typeof e)throw new TypeError;for(var o=new Array(n),i=arguments[2],a=0;n>a;a++)a in r&&(o[a]=e.call(i,r[a],a,r));return o};var o=function(t,e){return Array.prototype.slice.call(t,e||0)};return{every:t,forEach:e,filter:r,toArray:o,map:n}}(),Davis.listener=function(){var t={A:function(t){return t.host!==window.location.host||t.protocol!==window.location.protocol},FORM:function(t){var e=document.createElement("a");return e.href=t.action,this.A(e)}},e=function(e){return t[e.nodeName.toUpperCase()]?t[e.nodeName.toUpperCase()](e):!0},r=function(t){return t.altKey||t.ctrlKey||t.metaKey||t.shiftKey},n=function(t){return function(n){if(r(n))return!0;if(e(this))return!0;var o=new Davis.Request(t.call(Davis.$(this)));return Davis.location.assign(o),n.stopPropagation(),n.preventDefault(),!1}},o=n(function(){var t=this;return{method:"get",fullPath:this.prop("href"),title:this.attr("title"),delegateToServer:function(){window.location=t.prop("href")}}}),i=n(function(){var t=this;return{method:this.attr("method"),fullPath:this.serialize()?[this.prop("action"),this.serialize()].join("?"):this.prop("action"),title:this.attr("title"),delegateToServer:function(){t.submit()}}});this.listen=function(){Davis.$(document).delegate(this.settings.formSelector,"submit",i),Davis.$(document).delegate(this.settings.linkSelector,"click",o)},this.unlisten=function(){Davis.$(document).undelegate(this.settings.linkSelector,"click",o),Davis.$(document).undelegate(this.settings.formSelector,"submit",i)}},Davis.event=function(){var t={};this.bind=function(e,r){return(t[e]=t[e]||[]).push(r),this},this.trigger=function(e){var r=Davis.utils.toArray(arguments,1),n=t[e];if(!n)return this;for(var o=0,i=n.length;i>o;++o)n[o].apply(this,r);return this}},Davis.logger=function(){function t(){return"["+Date()+"]"}function e(e){var r=Davis.utils.toArray(e);return r.unshift(t()),r.join(" ")}var r=function(t){return function(){window.console&&console[t](e(arguments))}},n=r("error"),o=r("info"),i=r("warn");this.logger={error:n,info:o,warn:i}},Davis.Route=function(){var t=/:([\w\d]+)/g,e="([^/]+)",r=/\*([\w\d]+)/g,n="(.*)",o=/[:|\*]([\w\d]+)/g,i=function(i,a,s){var u=function(){if(a instanceof RegExp)return a;var o=a.replace(t,e).replace(r,n);return a.lastIndex=0,new RegExp("^"+o+"$","gi")},l=function(){return i instanceof RegExp?i:new RegExp("^"+i+"$","i")},c=function(){for(var t,e=[];t=o.exec(a);)e.push(t[1]);return e};this.paramNames=c(),this.path=u(),this.method=l(),"function"==typeof s?this.handlers=[s]:this.handlers=s};return i.prototype.match=function(t,e){return this.reset(),this.method.test(t)&&this.path.test(e)},i.prototype.reset=function(){this.method.lastIndex=0,this.path.lastIndex=0},i.prototype.run=function(t){this.reset();var e=this.path.exec(t.path);if(e){e.shift();for(var r=0;r<e.length;r++)t.params[this.paramNames[r]]=e[r]}var n=Davis.utils.map(this.handlers,function(t,e){return function(r){return t.call(r,r,n[e+1])}});return n[0](t)},i.prototype.toString=function(){return[this.method,this.path].join(" ")},i}(),Davis.router=function(){this.route=function(e,n){var o=function(n){var o,i,a=Davis.utils.toArray(arguments,1),s=r.join("");return o="string"==typeof n?s+n:n,i=new Davis.Route(e,o,a),t.push(i),i};return 1==arguments.length?o:o.apply(this,Davis.utils.toArray(arguments,1))},this.get=this.route("get"),this.post=this.route("post"),this.put=this.route("put"),this.del=this.route("delete"),this.state=this.route("state"),this.scope=function(t,e){r.push(t),1!=arguments.length&&(e.call(this,this),r.pop())},this.trans=function(t,e){if(e)var r=[t,decodeURIComponent(Davis.$.param(e))].join("?");else var r=t;var n=new Davis.Request({method:"state",fullPath:r,title:""});Davis.location.assign(n)},this.filter=function(t){return function(){var n=/.+/;if(1==arguments.length)var o=/.+/,i=arguments[0];else if(2==arguments.length)var o=r.join("")+arguments[0],i=arguments[1];var a=new Davis.Route(n,o,i);return e[t].push(a),a}},this.lookupFilter=function(t){return function(r,n){return Davis.utils.filter(e[t],function(t){return t.match(r,n)})}},this.before=this.filter("before"),this.after=this.filter("after"),this.lookupBeforeFilter=this.lookupFilter("before"),this.lookupAfterFilter=this.lookupFilter("after");var t=[],e={before:[],after:[]},r=[];this.lookupRoute=function(e,r){return Davis.utils.filter(t,function(t){return t.match(e,r)})[0]}},Davis.history=function(){function t(t){s.push(t)}function e(t){window.addEventListener("popstate",t,!0)}function r(t){return function(e){e.state&&e.state._davis?t(new Davis.Request(e.state._davis)):u&&t(Davis.Request.forPageLoad()),u=!0}}function n(t){return{_davis:t}}function o(n){t(n),e(r(n))}function i(t){return function(e,r){u=!0,history[t](n(e.toJSON()),e.title,e.location()),r&&r.silent||Davis.utils.forEach(s,function(t){t(e)})}}function a(){return window.location.pathname+(window.location.search?window.location.search:"")}var s=[],u=!1,l=i("pushState"),c=i("replaceState");return{onChange:o,current:a,assign:l,replace:c}}(),Davis.location=function(){function t(t){o=t}function e(){return o.current()}function r(t){return function(e,r){"string"==typeof e&&(e=new Davis.Request(e)),o[t](e,r)}}function n(t){o.onChange(t)}var o=Davis.history,i=r("assign"),a=r("replace");return{setLocationDelegate:t,current:e,assign:i,replace:a,onChange:n}}(),Davis.Request=function(){var t=function(e,r){"object"==typeof e&&(r=e,e=r.fullPath,delete r.fullPath);var n=Davis.$.extend({},{title:"",fullPath:e,method:"get",timestamp:+new Date},r);n.fullPath=n.fullPath.replace(/\+/g,"%20");var o=this;this.raw=n,this.params={},this.title=n.title,this.queryString=n.fullPath.split("?")[1],this.timestamp=n.timestamp,this._staleCallback=function(){},this.queryString&&Davis.utils.forEach(this.queryString.split("&"),function(t){var e,r=decodeURIComponent(t.split("=")[0]),n=t.split("=")[1],i=/^(\w+)\[(\w+)?\](\[\])?/;if(e=i.exec(r)){var a=e[1],r=e[2],s=!!e[3],u=o.params[a]||{};s?(u[r]=u[r]||[],u[r].push(decodeURIComponent(n)),o.params[a]=u):r||s?(u[r]=decodeURIComponent(n),o.params[a]=u):(u=o.params[a]||[],u.push(decodeURIComponent(n)),o.params[a]=u)}else o.params[r]=decodeURIComponent(n)}),n.fullPath=n.fullPath.replace(/^https?:\/\/.+?\//,"/"),this.method=(this.params._method||n.method).toLowerCase(),this.path=n.fullPath.replace(/\?(.|[\r\n])+$/,"").replace(/^https?:\/\/[^\/]+/,""),this.fullPath=n.fullPath,this.delegateToServer=n.delegateToServer||Davis.noop,this.isForPageLoad=n.forPageLoad||!1,t.prev&&t.prev.makeStale(this),t.prev=this};return t.prototype.redirect=function(e,r){Davis.location.replace(new t({method:"get",fullPath:e,title:this.title}),r)},t.prototype.whenStale=function(t){this._staleCallback=t},t.prototype.makeStale=function(t){this._staleCallback.call(t,t)},t.prototype.location=function(){return"get"===this.method?decodeURI(this.fullPath):""},t.prototype.toString=function(){return[this.method.toUpperCase(),this.path].join(" ")},t.prototype.toJSON=function(){return{title:this.raw.title,fullPath:this.raw.fullPath,method:this.raw.method,timestamp:this.raw.timestamp}},t.forPageLoad=function(){return new this({method:"get",fullPath:Davis.location.current(),title:document.title,forPageLoad:!0})},t.prev=null,t}(),Davis.App=function(){function t(){this.running=!1,this.boundToInternalEvents=!1,this.use(Davis.listener),this.use(Davis.event),this.use(Davis.router),this.use(Davis.logger)}return t.prototype.configure=function(t){t.call(this.settings,this.settings)},t.prototype.use=function(t){t.apply(this,Davis.utils.toArray(arguments,1))},t.prototype.helpers=function(t){for(property in t)t.hasOwnProperty(property)&&(Davis.Request.prototype[property]=t[property])},t.prototype.settings={linkSelector:"a",formSelector:"form",throwErrors:!0,handleRouteNotFound:!1,generateRequestOnPageLoad:!1},t.prototype.start=function(){var t=this;if(!this.running){if(!Davis.supported())return void this.trigger("unsupported");var e=function(t){return function(e){var r=e.run(t,t);return"undefined"==typeof r||r}},r=function(r){return Davis.utils.every(t.lookupBeforeFilter(r.method,r.path),e(r))},n=function(n){if(r(n)){t.trigger("lookupRoute",n);var o=t.lookupRoute(n.method,n.path);if(o){t.trigger("runRoute",n,o);try{o.run(n),t.trigger("routeComplete",n,o)}catch(i){t.trigger("routeError",n,o,i)}Davis.utils.every(t.lookupAfterFilter(n.method,n.path),e(n))}else t.trigger("routeNotFound",n)}else t.trigger("requestHalted",n)},o=function(){t.bind("runRoute",function(e){t.logger.info("runRoute: "+e.toString())}).bind("routeNotFound",function(e){t.settings.handleRouteNotFound||e.isForPageLoad||(t.stop(),e.delegateToServer()),t.logger.warn("routeNotFound: "+e.toString())}).bind("start",function(){t.logger.info("application started")}).bind("stop",function(){t.logger.info("application stopped")}).bind("routeError",function(e,r,n){if(t.settings.throwErrors)throw n;t.logger.error(n.message,n.stack)}),Davis.location.onChange(function(t){n(t)}),t.boundToInternalEvents=!0};this.boundToInternalEvents||o(),this.listen(),this.trigger("start"),this.running=!0,this.settings.generateRequestOnPageLoad&&n(Davis.Request.forPageLoad())}},t.prototype.stop=function(){this.unlisten(),this.trigger("stop"),this.running=!1},t}(),$(document).ready(function(){var t=f52.inputs.homeIndex;t.filter,t.numChunks}),function(){var t=f52.datautils.urlParams(window.location.search),e=_.object($(".featured-topic").map(function(t,e){var r=$(e);return[[r.data("topic-tag"),{title:r.data("topic-title"),customButtonText:r.data("topic-custom-button-text")}]]})),r={numChunks:ko.observable(parseInt(t.n||"1")),urlFilter:ko.observable(t.t||"all"),loading:ko.observable(!1)};r.selectedTopicTag=ko.computed(function(){var t=r.urlFilter();return _.has(e,t)?t:null}),r.footerButtonText=ko.computed(function(){var t=r.selectedTopicTag();if(null===t)return r.loading()?"Loading&hellip;":"Load More";var n=e[t];return n.customButtonText?n.customButtonText+" &raquo;":"More about "+n.title+" &raquo;"}),r.footerButtonPath=ko.computed(function(){var t=r.selectedTopicTag(),e=r.numChunks()+1;return null===t?f52.datautils.paramsToSearch({t:"all",n:e}):"/topics/"+t}),f52.kovm.addToViewModel("home",r),$(document).ready(function(){!function(){var t=f52.inputs.homeIndex,e=Davis(function(){this.configure(function(){this.linkSelector="a.davis",this.formSelector="a.davis"}),this.get(t.homePath,function(e){if(!r.loading()){var n=e.params.t||"all",o=parseInt(e.params.n)||1,i=r.selectedTopicTag(),a=r.numChunks();r.urlFilter(n);var s=r.selectedTopicTag();if(s!==i||o!==a){r.loading(!0);var u=s!==i||a>o;$.get(u?t.ajaxFilterPath:t.ajaxMoreContentPath,{n:o,t:n}).success(function(t){r.numChunks(o),u&&$("#grid").find(".home-tile").remove(),$(t).appendTo($("#grid")),r.loading(!1),_.defer(function(){$(".home-tile:not(.revealed)").addClass("revealed")})}).error(function(){alert("unexpected error loading data"),window.location.reload()})}}})});e.start()}(),f52.ads.addTargeting("PageType","homepage")})}();