/**
* Time DFP v1.0.0
* Copyright 2016 Time Inc
* **/
!function(a){var b=function(){var b=this;a.addEventListener("dfp.beforeInit",function(a){b.fireEvents(b.onInit,[a.detail.dfp])}),a.addEventListener("dfp.afterInit",function(a){b.fireEvents(b.onAfterInit,[a.detail.dfp])}),a.addEventListener("dfp.defineSlot",function(a){b.fireEvents(b.defineSlot,[a.detail.dfp,a.detail.arg])}),a.addEventListener("dfp.slotAfterDefine",function(a){b.fireEvents(b.afterdefineSlot,[a.detail.dfp,a.detail.arg])}),a.addEventListener("dfp.slotBeforeDisplay",function(a){b.fireEvents(b.displaySlot,[a.detail.dfp,a.detail.arg])}),a.addEventListener("dfp.refresh",function(a){b.fireEvents(b.onRefresh,[a.detail.dfp])}),a.addEventListener("dfp.slotRefresh",function(a){b.fireEvents(b.onSlotRefresh,[a.detail.dfp,a.detail.arg])}),this.onInit=[],this.onAfterInit=[],this.onRefresh=[],this.onSlotRefresh=[],this.defineSlot=[],this.afterdefineSlot=[],this.displaySlot=[],this.blockLoad=!1};b.prototype.fireEvents=function(b,c){var d,e;for(d=0,e=b.length;e>d;d++)try{b[d].apply(a,c)}catch(f){console.error("error: tracking.fireEvents - "+b[d].toString()),console.error(f)}},a.dfp_tracking=new b}(window);var amznads=amznads||{};!function(){var a=function(a){var b,c=Date.now(),d=!1;"undefined"!=typeof a.config.amazon&&a.config.amazon===!1||(b=a.sleep("amazon"),amznads.asyncParams={id:"3042",callbackFn:function(){try{amznads.setTargetingForGPTAsync("amznslots")}catch(e){}a.log("Amazon Loaded in "+(Date.now()-c)+" milliseconds"),d?a.log("Amazon Already woke up dfp, bypassing wakeup()"):a.wakeup("amazon",b),d=!0},timeout:2e3},function(){var a,b=document.head||document.getElementsByTagName("head")[0];a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src="//c.amazon-adsystem.com/aax2/amzn_ads.js",b.appendChild(a)}())},b=function(a){var b,c=a;"undefined"!=typeof a.config.amazon&&a.config.amazon===!1||(b=a.sleep("amazon"),function(){googletag.cmd.push(function(){googletag.pubads().clearTargeting("amznslots");var a=function(){amznads.setTargetingForGPTAsync("amznslots"),c.wakeup("amazon",b)};amznads.getAdsCallback("3042",a)})}())};void 0!==window.dfp_tracking&&(window.dfp_tracking.onInit.push(a),window.dfp_tracking.onRefresh.push(b))}(),function(){var a=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=a.dfpUtil,n=m.getCookie("TI_PREFS");if(a.config.setTargeting=a.config.setTargeting||{},navigator.userAgent.match(/iPad/i)||"tablet"===n?a.config.setTargeting.plat="tablet":navigator.userAgent.match(/Mobi/)||"phone"===n||"iphone"===n?a.config.setTargeting.plat="mobile":a.config.setTargeting.plat="desktop",a.config.setGlobalTargeting=a.config.setGlobalTargeting||{},a.config.useBehaviorTracking||a.config.useRevSciTracking){for(c=[],g=[],d=m.getCookie("rsi_segs"),e=10,f="",l=[],null!==d&&c.rsi_cookie.split("|"),c.length<e&&(e=c.length),h=0;e>h;h++)l=c[h].split("_"),l.length>1&&g.push(l[1]);a.config.setGlobalTargeting.rsseg=g}if(a.config.useQuantcastTracking){for(b=[],i=m.getCookie("__qseg"),e=b.length,j=[],g=[],null!==i&&(b=i.split("|")),g[0]="",h=0;e>h&&10>h;h++)j=b[h].split("_"),j.length>1&&g.push(j[1]);a.config.setGlobalTargeting.qc=g}if(a.config.useTacodaTracking){if(cd_segs=[],tcd_segs_cookie=m.getCookie("AxData"),g=[],null!==tcd_segs_cookie&&(k=tcd_segs_cookie.split("#")),k.length>0&&k[1].indexOf("|")>0)for(k=k[1].split("|"),e="",l=[],e=k.length,h=0;e>h;h++)g.push(k[h]);else g.push(k[1]);a.config.setGlobalTargeting.tcseg=g}var o=document.referrer.split("/")[2];return a.config.setGlobalTargeting.domain=document.URL.split("/")[2],""!==document.referrer&&(a.config.setGlobalTargeting.rhost=o),"undefined"!=typeof o&&o==a.config.setGlobalTargeting.domain||(a.config.setGlobalTargeting.pu=0),a.config};void 0!==window.dfp_tracking&&window.dfp_tracking.onInit.push(a)}(),function(){var a={status:!1,map:{targeting:{slot:{aid:"content_id",ch:"site_section1",pid:"content_package_id",sch:"site_section2",ptype:"pi_page_type",ctype:"template_type"},page:{}}},get:function(a){return window.Ti.udo_metadata[a]},addDfpTargeting:function(a,b){var c=this;for(var d in a)c.checkIsDefined(d)&&(b.config.setTargeting[d]=c.get(a[d]))},addSlotTargeting:function(a,b){var c=this;for(var d in a)c.checkIsDefined(d)&&(b.config.setGlobalTargeting[d]=c.get(a[d]))},addConfig:function(a,b){var c=this;for(var d in a)c.checkIsDefined(d)&&(b.config[d]=c.get(a[d]))},checkIsDefined:function(a){return"undefined"!=typeof window.Ti&&"undefined"!=typeof window.Ti.udo_metadata[a]},init:function(a){if("undefined"!=typeof Ti&&"undefined"!=typeof Ti.udo_metadata){this.status=!0;var b=this;a.config.setTargeting=a.config.setTargeting||{},a.config.setGlobalTargeting=a.config.setGlobalTargeting||{};for(var c in this.map)if("targeting"==c)for(var d in this.map[c])"slot"==d&&b.addSlotTargeting(this.map[c][d],a),"page"==d&&b.addDfpTargeting(this.map[c][d],a);else b.addConfig(this.map[c],a)}}};void 0!==window.dfp_tracking&&window.dfp_tracking.onInit.push(a.init)}(),function(){var a=function(a){"undefined"!=typeof a.config.evidon&&a.config.evidon===!1||!function(a){var b=document.createElement("script");b.async=!0,b.type="text/javascript",b.src=a.isSecure()?"https://a248.e.akamai.net/f/1016/606/2d/tiads-ssl.timeinc.net/ads/evidon.js":"http://tiads.timeinc.net/ads/evidon.js";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}(a.dfpUtil)};void 0!==window.dfp_tracking&&window.dfp_tracking.onInit.push(a)}(),function(){var a=!1,b=0,c=2,d={rsm:"ls-realsimple.js",ckl:"ls-cookinglight.js",peo:"ls-people.js",col:"ls-coastalliving.js",enw:"ls-ew.js",fw:"ls-foodandwine.js",fort:"ls-fortune.js",golf:"ls-golf.js",hlt:"ls-health.js",ins:"ls-instyle.js",mre:"ls-myrecipes.js",pesp:"ls-peopleenespanol.js",si:"ls-si.js",sol:"ls-southernliving.js",sun:"ls-sunset.js",thedrive:"ls-thedrive.js",theoutfit:"ls-theoutfit.js",thesnug:"ls-thesnug.js",tim:"ls-time.js",tl:"ls-travelandleisure.js",mhi:"ls-myhomeideas.js",ess:"ls-essence.js",dep:"ls-departures.js",xoj:"ls-xojane.js",tfk:"ls-timeforkids.js",fansided:"ls-fansided.js",extracrispy:"ls-extracrispy.js"},e=function(c){if("undefined"==typeof c.config.ix||c.config.ix!==!1){var e,f,g,h,i,j=Date.now();if("undefined"==typeof c.config.indexexchange||c.config.indexexchange!==!1){if(i=c.sleep("Index Exchange"),window.headertag_init_once)return;b++,window.headertag_init_once=!0;try{e=("https:"==document.location.protocol?"https://js-sec":"http://js")+".indexww.com/ht/"+d[c.config.sitename],f=document.head||document.getElementsByTagName("head")[0],g=document.createElement("script"),g.type="text/javascript",g.onload=function(){c.log("Index Exchange loaded in "+(Date.now()-j)+" milliseconds"),headertag.envoke_on_or_after_session_end(function(){c.log("Index Exchange Retrieve Demand in "+(Date.now()-h)+" milliseconds"),a=!0,c.wakeup("Index Exchange",i)}),h=Date.now(),headertag.retrieve_demand()},g.async=!0,g.src=e,f.appendChild(g)}catch(k){c.log("Index Exchange loading error."),console.log(k)}}}},f=function(d,e){var f,g,h=e,i=d,j=Date.now(),k="";if(("undefined"==typeof d.config.ix||d.config.ix!==!1)&&"object"==typeof headertag){if("function"==typeof h.getSlotId)k=h.getSlotId().o;else if(Array.isArray(h))for(g=0;g<h.length;g++)"function"==typeof h[g].getSlotId&&(k+=h[g].getSlotId().o+" ");i.log("Index Exchange called for: "+k),a||c>b?(f=d.sleep("Index Exchange"),b++,a||i.log("Index Exchange sleep "+b+"/"+c)):i.log("Slot: "+k+" - Index Exchange Not Sleeping as we have not retrieved successful demand yet and executed "+b+"/"+c+" sleeps"),a=!1,headertag.retrieve_demand(function(){i.log("Index Exchange Retrieve Demand in "+(Date.now()-j)+" milliseconds"),i.log("Index Exchange Setting Targeting. - "+k),headertag.set_slot_targeting(h),a=!0,b=0,i.wakeup("Index Exchange",f)},{})}},g=function(a,b){"undefined"!=typeof a.config.ix&&a.config.ix===!1||f(a,b)},h=function(a){if("undefined"==typeof a.config.ix||a.config.ix!==!1){for(var b=a.getAdSlot(),c=[],d=0;d<b.length;d++)c.push(b[d].dfpSlot);f(a,c)}};void 0!==window.dfp_tracking&&(window.dfp_tracking.onInit.push(e),window.dfp_tracking.onRefresh.push(h),window.dfp_tracking.displaySlot.push(g))}(),function(){var a=function(a){var b,c=a.dfpUtil,d=a,e=c.getRootDomain(),f=Date.now(),g=!1,h=function(){var c,e=i.responseText,h={message:"empty"};if(""!==e&&(h=JSON.parse(e)),a.log("OneBot Response in "+(Date.now()-f)+" milliseconds"),"undefined"!=typeof h.trending&&h.trending&&(a.config.setTargeting.trend="yes"),"not found"!==h.message&&"empty"!==h.message){d.log("OneBot Message Results"),d.log(JSON.stringify(h));var j;if(h.socialtags&&h.socialtags.length>0){for(j=[],c=0;c<h.socialtags.length;c++)j.push(h.socialtags[c]);d.config.setTargeting.Social_Tags=j}if(h.taxons&&h.taxons.length>0){for(j=[],c=0;c<h.taxons.length;c++)if(h.taxons[c].score>=.5){var k=h.taxons[c].path.split("/");for(var l in k)""!==k[l]&&j.push(k[l].replace(/\s+/g,"").replace(/:/g,"").replace(/\?/g,""))}j=j.filter(function(a,b,c){return c.indexOf(a)===b}),d.config.setTargeting.Taxons=j}if(h.concepts&&h.concepts.length>0){for(j=[],c=0;c<h.concepts.length;c++)h.concepts[c].relevance>=.5&&j.push(h.concepts[c].name.replace(/\s+/g,"").replace(/:/g,"").replace(/\?/g,""));d.config.setTargeting.Concepts=j}if(h.sentiment&&h.sentiment.length>0){var m;m=h.sentiment[0]>=.75?"Very Positive":h.sentiment[0]>=.5?"Positive":h.sentiment[0]>=0?"Neutral":h.sentiment[0]>=-.5?"Negative":"Very Negative",d.config.setTargeting.Sentiment=m}}else d.log("OneBot Message Results - not found or empty"),d.log(JSON.stringify(h));g||(d.wakeup("One Bot",b),g=!0)};if(!("undefined"!=typeof a.config.onebot&&a.config.onebot===!1||"undefined"!=typeof a.config.onebot&&"allow"==a.config.onebot.allow_deny_mode&&a.config.onebot.enabled_root_domains.indexOf(e)>=0))try{var i,j,k,l;if(j=document.URL,j.indexOf("test-tiads.timeinc.net")>-1?j=j.replace("test-tiads.timeinc.net/dev/test/alchemy-contextual/ads/test/",""):j.indexOf("tiads.timeinc.net")>-1&&(j=j.replace("tiads.timeinc.net/ads/test/","")),k=j.indexOf("?")>0?j.substring(0,j.indexOf("?")):encodeURIComponent(j),a.dfpUtil.isTestMode()&&(k="http://www.ew.com/article/2015/07/23/hunger-games-mockingjay-part-2-trailer"),l=c.isSecure()?"https://ape-tagit.timeinc.net/?url="+k:"https://ape-tagit.timeinc.net/?url="+k,i=new XMLHttpRequest,"withCredentials"in i?i.open("GET",l,!0):"undefined"!=typeof XDomainRequest?i.open("GET",l,!0):i=null,!i)return void console.error("OneBot Treding+Alchemy XMLHttpRequest Initialization Error");b=d.sleep("One Bot"),d.log("Checking trending+Alchemy via OneBot for - "+k),i.onload=h,i.onerror=function(){console.error("OneBot Trending+Alchemy Request Error")},i.send()}catch(m){console.error("Onebot catch error"),console.error(m)}};void 0!==window.dfp_tracking&&window.dfp_tracking.onInit.push(a)}(),function(){var a=function(a){"undefined"!=typeof a.config.realvu&&a.config.realvu===!0&&!function(b,c){var d=b.createElement(c),e=b.getElementsByTagName(c)[0];d.async=!0,d.src="prod"==a.config.env?"//ac.realvu.net/realvu_boost.js":"//ac-stage.realvu.net/realvu_boost.js",e.parentNode.insertBefore(d,e)}(document,"script")},b=function(a,b){if("undefined"!=typeof a.config.realvu&&a.config.realvu===!0)try{var c=top1.realvu_boost.addUnitById({partner_id:"E1OU",unit_id:b.adUnit.id,size:b.adUnit.size});b.dfpSlot.setTargeting("realvu",c)}catch(d){a.log("Problem with Realvu dfp key value pair setting up or not loaded")}};void 0!==window.dfp_tracking&&(window.dfp_tracking.onInit.push(a),window.dfp_tracking.afterdefineSlot.push(b))}(),function(a){var b=function(){var b=this,c=Date.now();a.addEventListener("dfp.beforeInit",function(a){a.detail.dfp.dfpUtil.isDebugMode()&&b.addDebugStyle()}),a.addEventListener("dfp.slotAfterDisplay",function(a){a.detail.dfp.dfpUtil.isDebugMode()&&b.createDebugInfo(a.detail.arg)}),a.addEventListener("dfp.logMsg",function(a){var b=(Date.now()-c)/1e3;a.detail.dfp.dfpUtil.isDebugMode()&&(console.log("dfp.logMsg "+b+": "+a.detail.arg),void 0!==a.detail.dfp.config&&void 0!==a.detail.dfp.config.logtimeline&&void 0!==console.timeStamp&&console.timeStamp("dfp.logMsg "+b+": "+a.detail.arg))})};return b.prototype.addDebugStyle=function(){var a=".ads-debug-info { position: absolute; overflowY: auto; overflowX: auto; width: 300; height: 200; zIndex: 99999; background-color: yellow; text-align: left}",b=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),b.appendChild(c)},b.prototype.createDebugInfo=function(a){var b,c,d,e,f,g=a.adUnit.id,h=g+"-debuginfo";return null===document.getElementById(h)?(c=document.getElementById(g),d=c.getBoundingClientRect(),e={top:d.top+document.body.scrollTop,left:d.left+document.body.scrollLeft},f='<textarea id="'+h+'" style="height: 20px; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 12px; line-height: normal; font-family: courier; border: 1px solid black; z-index: auto; background-color: rgb(255, 255, 189);">'+a.debugcode.join("\n")+"</textarea>",c.insertAdjacentHTML("beforebegin",f),b=document.getElementById(h)):b=document.getElementById(h),b},new b}(window),function(a){var b=function(){var b=0;a.addEventListener("dfp.beforeInit",function(b){var c,d,e,f,g,h=b.detail.dfp,i=h.dfpUtil.getUrlTargeting().Query;g=document.referrer.split("/")[2],void 0!==g&&(h.config.setGlobalTargeting.rhost=g);try{c=a.location.hostname}catch(j){c=document.URL.split("/")[2]}if(h.config.setGlobalTargeting.domain=c,d=a.location.pathname.split("/"),d=d[d.length-1]?d.slice(1,d.length):d.slice(1,d.length-1),h.config.setGlobalTargeting.path=d,h.dfpUtil.isDebugMode())for(f=0;f<i.length;f++)i[f].indexOf("debugads")>=0&&(e=i[f].split(":")[1],h.config.setGlobalTargeting.debugads=isNaN(e)?1:e);for(f=0;f<i.length;f++)i[f].indexOf("cid")>=0&&(e=i[f].split(":")[1],h.config.setGlobalTargeting.cid=isNaN(e)?1:e)}),a.addEventListener("dfp.slotBeforeDefine",function(a){var c,d=a.detail.arg,e=a.detail.dfp;b++,c=e.dfpUtil.sizeToArray(d.size),e.dfpUtil.hasSize(d.size,"300x250")&&e.dfpUtil.addSize(d,"fluid");try{void 0===d.targeting&&(d.targeting={}),void 0!==d.targeting.sz?-1!=d.targeting.sz.indexOf(",")&&(d.targeting.sz=d.targeting.sz.split(",")):(d.targeting.sz=e.dfpUtil.sizeToArray(d.size),void 0!==d.oop&&d.oop&&(d.targeting.sz="1x1")),d.targeting.id=d.id,d.targeting.tile=b}catch(f){}})};return new b}(window),function(a){var b,c,d=!1,e=!1,f=null,g=0,h=1e4,i=function(){};return i.prototype.defineOopSlot=function(a,b){var d,e,g,h,i=null;c=a,e=document.createElement("div"),e.setAttribute("id",f),e.setAttribute("style","display:none;width:0px;height:0px"),void 0!==b&&(i=document.getElementById(b)),null!==i?(g=i.parentNode,g.insertBefore(e,i)):(h=document.body,h.appendChild(e)),d={id:f,oop:!0},c.defineSlot(d)},i.prototype.refreshOop=function(){e&&null!==f&&c.refresh(f)},b=new i,a.addEventListener("dfp.beforeInit",function(a){var g=a.detail.dfp;void 0!==g.config.oop&&(d=g.config.oop),void 0!==g.config.refreshoop&&(e=g.config.refreshoop),g.getOopSlotId=function(){return f},g.resetOOPSlot=function(a,d){void 0!==a&&a!==f?(f=a,b.defineOopSlot(c,d)):b.refreshOop()}}),a.addEventListener("dfp.defineSlot",function(a){var c=a.detail.arg,e=a.detail.dfp;d&&null===f&&(f="oop_"+Date.now(),b.defineOopSlot(e,c.id))}),a.addEventListener("dfp.refresh",function(a){d&&e&&g+h<Date.now()&&(g=Date.now(),c.refresh(f))}),b}(window),function(a,b){a.time_dfp=b(a)}(this,function(a){var b,c={getRootDomain:function(){var b=a.location.hostname.split(".");return"undefined"==typeof b[1]?a.location.hostname:1==b.length?a.location.hostname:b[b.length-2]+"."+b[b.length-1]},getSubDomain:function(){return document.domain},isDebugMode:function(){var c=!1;return a.location.search.indexOf("debugads")>=0&&(c=!0),void 0!==b&&void 0!==b.config.debug&&b.config.debug&&(c=!0),c},isTestMode:function(b){var c=!1;return a.location.search.indexOf("testads")>=0&&(c=!0),void 0!==b&&void 0!==b.testads&&(c=!0),c},isSecure:function(){return"https:"==document.location.protocol},getCookie:function(a){return a?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},sizeToArray:function(a,b){var c,d=[],e=function(a){return Array.isArray(a)?a[0]+"x"+a[1]:a};if(void 0===b&&(b=!0),Array.isArray(a))if("number"==typeof a[0]&&b)d=e(a);else if("number"!=typeof a[0]||b)for(c=0;c<a.length;c++)d.push(b?e(a[c]):a[c]);else d.push(b?e(a):a);return d},sizeStringToArray:function(a){return Array.isArray(a)?a:(a=a.split("x"),a[0]=+a[0],a[1]=+a[1],a)},extend:function(a){a=a||{};for(var b=1;b<arguments.length;b++)if(arguments[b])for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&(a[c]=arguments[b][c]);return a},getUrlTargeting:function(b){var c=(b||a.location.toString()).match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/),d=c[4]||"",e=(c[5]||"").replace(/(.)\/$/,"$1"),f=c[7]||"",g=f.replace(/\=/gi,":").split("&");return{Host:d,Path:e,Query:g}},sanitize:function(a,b){return"string"==typeof a&&(b.convertHyphens&&(a=a.replace(/-/gi,"_")),b.stripNonAlphaNumeric&&(a=a.replace(/[^\w\/]/gi,""))),a},hasSize:function(a,b){var c=this.sizeToArray(a),d=!1;if(Array.isArray(c)||-1===c.indexOf(b)){if(Array.isArray(c))for(var e=0;e<c.length;e++)if(-1!==c[e].indexOf(b)){d=!0;break}}else d=!0;return d},addSize:function(a,b){var c=this.sizeToArray(a.size,!1);this.hasSize(a.size,b)||(c.push(b),a.size=c)}},d=function(){var b,d;if(this.dfpUtil=c,this.log("Starting up..."),this.config={setTargeting:{},setGlobalTargeting:{},setLocation:"",setUrlTargeting:!1,enableSingleRequest:!1,SRAInitialBatch:!0,collapseEmptyDivs:!1,refreshExisting:!0,disablePublisherConsole:!1,disableInitialLoad:!1,globalVar:"time_dfp",sleepTime:500,oop:!0,gptAsync:!0,refreshoop:!1,env:"prod"},this.state={count:0,rendered:0,dfpId:"8484",slots:[],sleep:0,queue:[],purge_count:0,purging:!1,wewant:'n"eNow',sleepTimeout:null,sleepInterval:null,sleepStart:null,sleepRound:0,ver:"20161208.1"},void 0!==a[this.config.globalVar]&&Array.isArray(a[this.config.globalVar]))for(b=a[this.config.globalVar],a[this.config.globalVar]=this,d=0;d<b.length;d++)this.push(b[d])},e=d.prototype;return e.init=function(a){var b=this;if(this.log("init()"),this.loadGPT(),c.extend(this.config,void 0!==a?a:{}),this.setConfig(),this.fireEvent("beforeInit",this),this.updateAdsTargeting(this.config),this.getGptCmd().push(function(){b.log("1st DFP Call")}),void 0!==this.config.disableInitialLoad&&this.config.disableInitialLoad&&this.push(function(){b.getGptCmd().push(function(){b.log("disableInitialLoad() is set.. need to .refresh() to display ads now."),googletag.pubads().disableInitialLoad()})}),void 0!==this.config.enableSingleRequest&&this.config.enableSingleRequest&&this.push(function(){b.getGptCmd().push(function(){b.log("enableSingleRequest is set.. in SRA mode"),googletag.pubads().enableSingleRequest()})}),this.push(function(){b.getGptCmd().push(function(){b.log("enableServices()"),googletag.enableServices()})}),void 0!==this.config.enableSingleRequest&&this.config.enableSingleRequest&&this.push(function(){b.getGptCmd().push(function(){b.log("enableSingleRequest is set all slots defined before 1st .display() will be call and rendered all at once")})}),void 0!==this.config.collapseEmptyDivs){var d=b.config.collapseEmptyDivs;d||(d=void 0),this.push(function(){b.getGptCmd().push(function(){b.log("collapseEmptyDivs is set to: "+b.config.collapseEmptyDivs),googletag.pubads().collapseEmptyDivs(d)})})}return this.getGptCmd().push(function(){var a=b;googletag.pubads().addEventListener("slotRenderEnded",function(b){a.eventSlotRendered(b)})}),this.push(function(){b.getGptCmd().push(function(){b.log("googletag.pubads().setTargeting()..");for(var a in b.config.setTargeting)b.config.setTargeting.hasOwnProperty(a)&&googletag.pubads().setTargeting(a,b.config.setTargeting[a])})}),this.push(function(){b.fireEvent("afterInit",b)}),this},e.setConfig=function(){for(var a,b,d=c.getUrlTargeting().Query,e=["amazon","ix","debugads","onebot","logtimeline"],f=0;f<d.length;f++)b=d[f].split(":")[0],e.indexOf(b)>-1&&(a=d[f].split(":")[1],0!==a&&"0"!==a&&"false"!==a||(a=!1),this.config[b]=a)},e.push=function(a){var b;if(void 0===a&&!this.state.purging){for(this.log("Running Queued calls... purge: "+this.state.purge_count),b=this.state.queue,this.state.queue=[],this.state.purging=!0;b.length;)try{b.shift().apply(this,[])}catch(c){this.log("Error trying to wake up running one of the queued function. Purge:"+this.state.purge_count),console.error(c);break}return this.log("Ending Queue purge: "+this.state.purge_count),this.state.purge_count++,this.state.purging=!1,void(this.state.queue.length>0&&this.state.sleep<=0&&(this.log("Calling calls queued during purge."),this.push()))}void 0===a&&this.state.purging||(this.state.sleep<=0&&!this.state.purging?a.apply(this,[]):this.state.sleep<=0&&this.state.purging?(this.log("push().. purging queue.. queuing function"),this.state.queue.push(a)):(this.log("push().. in sleep mode.. queuing function"),this.state.queue.push(a)))},e.sleep=function(a,b){var c,d=this,e=this.state.sleepRound;return a=void 0!==a?" - MSG: "+a:"",this.state.sleep>0?(this.state.sleep++,this.log("sleep().. cannot sleep.. already sleeping"+a+" - SleepRound:"+e),this.state.sleepRound):(this.state.sleep++,void 0!==b&&null!==b||(b=this.config.sleepTime),c=b,this.log("sleep() for "+b+" milliseconds"+a+" - SleepRound:"+e),this.state.sleepTimeout=setTimeout(function(){d.log("sleep() Timeout Over"),d.wakeup("time_dfp - Sleep Timeout",e,!0)},b),this.state.sleepStart=Date.now(),this.state.sleepInterval=setInterval(function(){var a=Date.now();d.log("sleepInterval at: "+(a-d.state.sleepStart)),a-d.state.sleepStart>c&&(d.log("sleep() Interval Over"),d.wakeup("time_dfp - Sleep Timeout",e,!0))},b/5),this.state.sleepRound)},e.wakeup=function(b,c,d){return b=void 0!==b?" - MSG: "+b:"",void 0!==c&&c!==this.state.sleepRound?(inSleepRound=!0,this.log("wakeup() "+b+" -- Not in sleep round"),!1):(this.state.sleep--,this.log("wakeup() "+b+" -- Sleeps left: "+this.state.sleep+" -- "+(void 0!==d&&d?" - Forced":"")),void((this.state.sleep<=0||void 0!==d&&null!==d&&d)&&(this.state.sleep=0,a.clearTimeout(this.state.sleepTimeout),a.clearInterval(this.state.sleepInterval),this.state.sleepRound++,this.push())))},e.loadGPT=function(){var b,c,d="async";void 0!==a.googletag&&void 0!==a.googletag.pubads||(a.googletag=a.googletag||{},a.googletag.cmd=a.googletag.cmd||[],b=document.createElement("script"),b.async=!0,void 0===this.config.gptAsync||this.config.gptAsync||(b.async=!1,d="sync"),this.log("loading GPT in "+d),b.type="text/javascript",b.src="//www.googletagservices.com/tag/js/gpt.js",c=document.getElementsByTagName("script")[0],c.parentNode.insertBefore(b,c))},e.eventSlotRendered=function(a){this.fireEvent("slotRenderEnded",a)},e.updateAdsTargeting=function(a){if(c.isTestMode(a)){this.log("updateAdsTargeting() In Test Mode");var b,d=c.getUrlTargeting().Query;void 0!==this.config.testads&&(this.config.setGlobalTargeting.test=isNaN(this.config.testads)?1:this.config.testads);for(var e=0;e<d.length;e++)d[e].indexOf("testads")>=0&&(b=d[e].split(":")[1],this.config.setGlobalTargeting.test=isNaN(b)?1:b)}},e.getGptCmd=function(){return a.googletag=a.googletag||{version:"timeinc",cmd:[]},a.googletag.cmd},e.adUnitPath=function(a){var b=void 0!==a&&void 0!==a.zone?a.zone:void 0!==this.config.zone?this.config.zone:"";return b=""!==b&&"/"!==b?("/"===b.charAt(0)?"":"/")+this.dfpUtil.sanitize(b,{stripNonAlphaNumeric:!0}):"","/"+this.state.dfpId+"/"+(void 0!==a&&void 0!==a.sitename?a.sitename:this.config.sitename)+b},e.getAdSlot=function(a,b){var c,d,e=null,f=[];for(d=0,c=this.state.slots.length;c>d;d++)if(void 0===a)f.push(this.state.slots[d]);else if(this.state.slots[d].id===a){void 0!==b&&b?(e=this.state.slots.splice(d,1),e=e[0]):e=this.state.slots[d];break}return void 0===a?f:e},e.getAdIdBySlot=function(a){var b,c,d;for(c=0,b=this.state.slots.length;b>c;c++)if(this.state.slots[c].dfpSlot===a){d=this.state.slots[c].id;break}return d},e.setTargeting=function(a,b){var c;for(c in this.config.setGlobalTargeting)this.config.setGlobalTargeting.hasOwnProperty(c)&&a.setTargeting(c,this.config.setGlobalTargeting[c]);if(void 0!==b.targeting)for(c in b.targeting)b.targeting.hasOwnProperty(c)&&a.setTargeting(c,b.targeting[c])},e.defineSlot=function(a){var b=a,c=this;null!==this.getAdSlot(a.id)&&this.getGptCmd().push(function(){var a=c.getAdSlot(b.id,!0);googletag.destroySlots([a.dfpSlot])}),this.fireEvent("defineSlot",b),this.log("defineSlot() called for "+a.id+" - queuing up"),this.push(function(){c.getGptCmd().push(function(){var a,d,e,f={},g=[];try{if(c.fireEvent("slotBeforeDefine",b),f.id=b.id,f.adUnit=b,a=b.size,void 0!==b.sizes){for(d=googletag.sizeMapping(),e=0;e<b.sizes.length;e++)d.addSize(b.sizes[e][0],b.sizes[e][1]);d=d.build()}void 0!==b.oop&&b.oop?(f.dfpSlot=googletag.defineOutOfPageSlot(c.adUnitPath(b),b.id),g.push("googletag.defineOutOfPageSlot('"+c.adUnitPath(b)+"', '"+b.id+"');")):(f.dfpSlot=googletag.defineSlot(c.adUnitPath(b),a,b.id),g.push("googletag.defineSlot('"+c.adUnitPath(b)+"', "+JSON.stringify(b.size)+", '"+b.id+"');")),void 0!==d&&(f.dfpSlot.defineSizeMapping(d),g.push("slot.defineSizeMapping(<sizemapping>); sizemapping = "+JSON.stringify(b.sizes))),c.setTargeting(f.dfpSlot,b),g.push(c.getSlotTargeting(f.dfpSlot)),void 0!==b.companion&&b.companion&&(f.dfpSlot.addService(googletag.companionAds()),g.push(".addService(googletag.companionAds();")),f.dfpSlot.addService(googletag.pubads()),g.push(".addService(googletag.pubads();"),c.state.slots.push(f),void 0!==c.config.enableSingleRequest&&c.config.enableSingleRequest||(googletag.enableServices(),g.push("googletag.enableServices();")),void 0!==b.collapse?(Array.isArray(b.collapse)?f.dfpSlot.setCollapseEmptyDiv.apply(f.dfpSlot,b.collapse):f.dfpSlot.setCollapseEmptyDiv(b.collapse),g.push(".setCollapseEmptyDiv("+b.collapse+")")):(f.dfpSlot.setCollapseEmptyDiv(),g.push(".setCollapseEmptyDiv();")),c.fireEvent("slotAfterDefine",f),f.debugcode=g,c.log("slot defined for - "+b.id),(void 0===c.config.enableSingleRequest||!c.config.enableSingleRequest||void 0!==c.config.disableInitialLoad&&c.config.disableInitialLoad)&&c.displaySlot(f)}catch(h){console.error("error: defineSlot - "),console.error(f),console.error(h)}})})},e.set=function(a,b){this.config[a]=b},e.display=function(a){var b=a,c=this;c.log(".display()"),this.push(function(){c.getGptCmd().push(function(){var a,d;if(c.log(".display() via gpt.push()"),void 0===b)for(a=c.getAdSlot(),d=0;d<a.length;d++)c.displaySlot(a[d]);if("string"==typeof b)a=c.getAdSlot(b),c.displaySlot(a);else if(Array.isArray(b))for(d=0;d<b.length;d++)a=c.getAdSlot(b[d]),c.displaySlot(a)})})},e.displaySlot=function(a){var b=this,c=a;this.push(function(){b.getGptCmd().push(function(){b.log("before displaying slot - "+a.id),b.fireEvent("slotBeforeDisplay",c.dfpSlot),b.log("displaying slot - "+a.id),void 0!==b.config.disableInitialLoad&&b.config.disableInitialLoad&&b.log("slot - "+a.id+" - may not be rendered and need to be refresh()'ed as disableInitialLoad is set."),b.push(function(){b.getGptCmd().push(function(){b.log("gpt .display() - "+a.id),googletag.display(a.id),c.debugcode.push("googletag.display('"+c.id+"');"),b.fireEvent("slotAfterDisplay",c)})})})})},e.getSlotTargeting=function(a){var b,c={},d=a.getTargetingKeys(a),e={},f="";for(b=0;b<d.length;b++)c[d[b]]=a.getTargeting(d[b]);for(b in this.config.setTargeting)this.config.setTargeting.hasOwnProperty(b)&&(e[b]=this.config.setTargeting[b]);return f+="\nTargeting ---- \nGLOBAL: "+JSON.stringify(e),f+="\nSLOT: "+JSON.stringify(c)+"\n ------ \n"},e.refresh=function(a,b){var c,d,e,f=[],g={},h=this,i=function(){h.fireEvent("refresh",a),void 0===b&&(b=!0),g.changeCorrelator=b,void 0===a&&(a=null,f=a),h.log("refresh() slots: "+a);try{if("string"==typeof a&&(c=h.getAdSlot(a),f.push(c.dfpSlot)),Array.isArray(a))for(d=0,e=a.length;e>d;d++)"string"==typeof a[d]&&(c=h.getAdSlot(a[d]),f.push(c.dfpSlot))}catch(i){h.log("Error refreshing slots"),console.log(i)}_refreshSlots=f,h.push(function(){h.push(function(){h.getGptCmd().push(function(){h.fireEvent("slotRefresh",f),h.log("dfp refreshing slots"),googletag.pubads().refresh(f,g)})})})};this.push(function(){h.getGptCmd().push(function(){i()})})},e.updateCorrelator=function(){var a=this;this.log("updateCorrelator()"),this.getGptCmd().push(function(){a.fireEvent("updateCorrelator"),googletag.pubads().updateCorrelator()})},e.log=function(a){this.fireEvent("logMsg",a)},e.fireEvent=function(b,c){var d,e,f,g,h;"beforeInit"===b&&(g=c),"afterInit"===b&&(g=c),"defineSlot"===b&&(d=c),"slotBeforeDefine"===b&&(d=c),"slotAfterDefine"===b&&(e=c),"refresh"===b&&(f=c),"slotRefresh"===b&&(f=c),"function"==typeof a.CustomEvent?h=new CustomEvent("dfp."+b,{detail:{arg:c,dfp:this}}):(h=document.createEvent("CustomEvent"),h.initCustomEvent("dfp."+b,!0,!0,{arg:c,dfp:this})),a.dispatchEvent(h)},b=new d});